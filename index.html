<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Portal</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />

    <style>
        body {
            height: 100vh;
            background: linear-gradient(45deg, #6C5B7B, #C06C84, #F67280);
            font-family: 'Arial', sans-serif;
        }

        nav {
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
            background-color: #6C5B7B;
        }

        .navbar-brand img {
            transition: transform 0.3s;
        }

        .navbar-brand img:hover {
            transform: scale(1.1);
        }

        .container {
            background-color: #F8B195;
            border: 2px solid #C06C84;
            transition: transform 0.3s;
        }

        .container:hover {
            transform: scale(1.03);
        }

        button {
            transition: background-color 0.3s, transform 0.3s;
        }

        button:hover {
            background-color: #F67280;
            transform: translateY(-5px);
        }

        #status-message {
            display: none;
            font-weight: bold;
        }

        .entry-exit-btns {
            margin-top: 20px;
        }

        #registrationForm {
            display: none;
            background: #F8B195;
            padding: 10px;
            border-radius: 10px;
            border: 1px solid #C06C84;
        }

        .camera-container {
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 10px;
        }

        .fadeInDown {
            animation-name: fadeInDown;
            animation-duration: 1s;
        }
    </style>
</head>

<body>

<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#"><img src="download.jpg" alt="Company Logo" height="50"></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <!-- Add navigation links if needed -->
    </div>
</nav>

<div class="container animate__animated animate__fadeInDown">
    <h2 class="text-center mb-4">Employee Portal</h2>
    <div id="registrationForm">
        <form>
            <div class="form-group">
                <label for="employeeName">Full Name</label>
                <input type="text" class="form-control" id="employeeName" placeholder="Enter your name">
            </div>
            <div class="form-group">
                <label for="employeeEmail">Email Address</label>
                <input type="email" class="form-control" id="employeeEmail" placeholder="Enter your email">
            </div>
            <!-- ... add other input fields as needed ... -->
            <button type="button" class="btn btn-success" id="registerEmployee">Register</button>
        </form>
    </div>
    <div class="camera-container">
        <video id="video" width="640" height="480" autoplay></video>
        <button id="snap" class="btn btn-primary mt-3">Snap Photo</button>
        <button id="clear" class="btn btn-secondary mt-3 ml-2">Clear</button>
        <div class="entry-exit-btns">
            <button id="entry" class="btn btn-success mt-3">Mark Entry</button>
            <button id="exit" class="btn btn-danger mt-3 ml-2">Mark Exit</button>
        </div>
        <canvas id="canvas" width="640" height="480" class="mt-3"></canvas>
        <p id="status-message" class="mt-3 text-center"></p>
    </div>
</div>

<script>
    async function postData(url = '', data = {}) {
        try {
            const response = await axios.post(url, data);
            document.getElementById("status-message").textContent = "Operation successful!";
            document.getElementById("status-message").style.color = "green";
            document.getElementById("status-message").style.display = "block";
            return response.data;
        } catch (error) {
            document.getElementById("status-message").textContent = "Error performing operation.";
            document.getElementById("status-message").style.color = "red";
            document.getElementById("status-message").style.display = "block";
            console.error("Error:", error);
        }
   
    }
        
        // Camera access
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ video: true }).then(function (stream) {
                const video = document.getElementById('video');
                video.srcObject = stream;
                video.play();
            });
        }

        // Snap photo event
        document.getElementById("snap").addEventListener("click", function () {
            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, 640, 480);

            let imageData = canvas.toDataURL('image/png');
            
            // For demonstration, using the same endpoint. In real-world apps, you'd likely have different endpoints.
            postData('/take-attendance', {
                image: imageData,
                action: 'snap',
                school_id: 'YOUR_SCHOOL_ID',
                role: 'YOUR_ROLE',
                uid: 'YOUR_UID',
                type: 'YOUR_TYPE'
            });
        });

        // Clear canvas event
        document.getElementById("clear").addEventListener("click", function () {
            const canvas = document.getElementById('canvas');
            const context = canvas.getContext('2d');
            context.clearRect(0, 0, canvas.width, canvas.height);
            document.getElementById("status-message").style.display = "none";
        });

        // Mark Entry event
        document.getElementById("entry").addEventListener("click", function () {
            postData('/take-attendance', {
                action: 'entry',
                uid: 'YOUR_UID' // Replace with dynamically retrieved UID for the employee
            });
        });

        // Mark Exit event
        document.getElementById("exit").addEventListener("click", function () {
            postData('/take-attendance', {
                action: 'exit',
                uid: 'YOUR_UID' // Replace with dynamically retrieved UID for the employee
            });
        });

        // Employee Registration
        document.getElementById("registerEmployee").addEventListener("click", function () {
            let name = document.getElementById("employeeName").value;
            let email = document.getElementById("employeeEmail").value;

            // Validate input here if needed

            postData('/register-employee', {
                name: name,
                email: email,
                // Add other fields as needed
            });
        });

        // Note: Handle 3D animations using Three.js. Implementing 3D animations requires a deeper understanding of the visual needs and the library itself. 
        // This is a broad topic, and I recommend referring to the Three.js documentation or seeking specialized help.
</script>

</body>
</html>
